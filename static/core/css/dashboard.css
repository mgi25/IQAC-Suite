:root{
  --primary:#264487;--ink:#0f172a;--muted:#64748b;--border:#e5e7eb;
  --surf:#ffffff;--subtle:#f8fafc;--tint:#eef2ff;--shadow:0 8px 24px rgba(2,6,23,.06);
  --shadow-lg:0 12px 40px rgba(2,6,23,.1);

  /* dynamic vars set by JS */
  --calH:auto;
  --contribH:auto;
  --todoBodyH:auto;
}

/* -------- Base typography & helpers (new) -------- */
.ems-dashboard{font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;}
.ems-dashboard p, .ems-dashboard li, .ems-dashboard span, .ems-dashboard input,
.ems-dashboard select,.ems-dashboard textarea,.ems-dashboard button{line-height:1.5; letter-spacing:.01em; color:var(--ink);}
.ems-dashboard h1,.ems-dashboard h2,.ems-dashboard h3,.ems-dashboard h4{letter-spacing:.005em; color:var(--ink); margin:0;}
.ems-dashboard .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px;}

.ems-dashboard *{box-sizing:border-box}

/* Focus visibility (accessible) */
.ems-dashboard a:focus-visible,
.ems-dashboard button:focus-visible,
.ems-dashboard select:focus-visible,
.ems-dashboard input:focus-visible,
.ems-dashboard textarea:focus-visible{outline:3px solid rgba(38,68,135,.35); outline-offset:2px; border-radius:6px}

/* Reduced motion */
@media (prefers-reduced-motion:reduce){
  .ems-dashboard *{animation:none!important;transition:none!important}
}

/* -------- header -------- */
.topbar{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:24px;padding-bottom:12px;border-bottom:1px solid var(--border);}
.topbar h1{margin:0;font-size:28px;font-weight:700;color:var(--ink);}
.topbar-date{color:var(--muted);font-size:14px}

/* -------- TOP ROW -------- */
.kpi-row{
  display:grid;
  /* KPIs narrower, Profile wider (no height changes) */
  grid-template-columns:0.9fr 0.9fr 0.9fr 0.9fr 1.8fr;
  gap:16px;
  margin-bottom:16px;
}
@media (max-width:1400px){
  .kpi-row{grid-template-columns:repeat(2,1fr);--kpiH:120px;--profileH:84px;}
}
@media (max-width:768px){
  .kpi-row{grid-template-columns:1fr;}
}

/* KPI layout â€” Row 1: icon + description; Row 2: number with short underline */
.kpi-card{
  background:var(--surf);border:1px solid var(--border);border-radius:12px;padding:12px;
  box-shadow:var(--shadow);transition:transform .2s ease,box-shadow .2s ease;
  display:grid;grid-template-columns:auto 1fr;grid-template-rows:auto auto;
  grid-template-areas:"icon title" "value value";
  align-items:start;gap:10px;cursor:pointer;
}
.kpi-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg);}
.kpi-card:active{transform:translateY(0);}

/* Row 1 */
.kpi-icon{
  grid-area:icon;
  width:48px;height:48px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  color:#fff;font-size:20px;flex-shrink:0;
}
.kpi-content{display:contents;}
.kpi-title{
  grid-area:title;
  align-self:center;
  margin:0 0 0 10px;
  font-size:14px;
  font-weight:700;
  color:var(--ink);
  text-align:left;
}

/* Row 2 */
.kpi-value{
  grid-area:value;
  justify-self:start;
  display:inline-block;
  font-size:40px!important;
  font-weight:900!important;
  line-height:1.05;
  color:var(--ink)!important;
  margin-top:6px;
  position:relative;
}
.kpi-value::after{
  content:"";
  display:block;
  height:2px;
  width:100%;
  margin-top:6px;
  background:var(--bar,#94a3b8);
  opacity:.6;
  border-radius:1px;
}

/* hide old progress bar */
.kpi-bar{display:none;}

.kpi-card:nth-child(1){--bar:#6366f1}
.kpi-card:nth-child(2){--bar:#0ea5e9}
.kpi-card:nth-child(3){--bar:#fb923c}
.kpi-card:nth-child(4){--bar:#10b981}

.bg-indigo{background:#6366f1}.bg-sky{background:#0ea5e9}.bg-orange{background:#fb923c}.bg-emerald{background:#10b981}

/* -------- Profile KPI -------- */
.profile-kpi{
  background:var(--surf);
  border:1px solid var(--border);
  border-radius:20px;
  box-shadow:var(--shadow);
  padding:12px 16px;
  display:grid;
  grid-template-columns: 140px 1fr;
  align-items:center;
  gap:14px;
}
.pkp-avatar{
  width:100%;
  height:100%;
  border-radius:16px;
  background:#e5e7eb;
  overflow:hidden;
}
.pkp-avatar img{width:100%;height:100%;object-fit:cover;}
.pkp-initials{
  width:100%;height:100%;
  display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:28px;color:var(--primary);
}
.pkp-body{min-width:0;display:flex;flex-direction:column;gap:4px}
.pkp-name{margin:0;font-size:20px;font-weight:800;color:var(--ink);line-height:1.1}
.pkp-sub{margin:0;font-size:14px;font-weight:600;color:var(--muted)}
.pkp-meta{margin:6px 0 0;display:flex;gap:16px;font-size:12px;font-weight:600;color:var(--muted)}
.pkp-meta strong{color:var(--ink);font-weight:800}
@media (max-width:1400px){
  .profile-kpi{grid-template-columns:120px 1fr;}
}
@media (max-width:768px){
  .profile-kpi{display:flex;gap:12px;}
  .pkp-avatar{width:56px;height:56px;border-radius:12px;}
  .pkp-initials{font-size:18px}
  .pkp-name{font-size:16px}
  .pkp-sub{font-size:12px}
}
.pkp-stats{display:flex;gap:10px;font-size:12px}
.pkp-stats span{background:#f1f5f9;border-radius:10px;padding:6px 10px;color:#475569}
.pkp-stats strong{color:var(--ink)!important;font-weight:700}

/* Mobile: auto heights */
@media (max-width:768px){
  .kpi-card,.profile-kpi{height:auto;}
}

/* -------- Main Grid -------- */
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;grid-auto-rows:minmax(380px,auto)}
@media (max-width:1200px){.grid-3{grid-template-columns:1fr;gap:16px}}

@media (min-width:1201px){
  .grid-3{
    grid-template-columns:minmax(0,1fr) minmax(0,1fr) minmax(0,1fr);
    gap:20px;
    grid-template-areas:
      "actions performance calendar"
      "contrib contrib    eventdetails";
  }
  #cardActions{grid-area:actions;}
  #cardPerformance{grid-area:performance;}
  #cardCalendar{grid-area:calendar;}
  #cardEventDetails{grid-area:eventdetails;}

  /* Contribution equals Actions+Performance width */
  #cardContribution{grid-area:contrib; grid-column:1 / span 2 !important;}

  /* keep equal-heights */
  #cardCalendar{height:var(--calH);}
  #cardActions{height:var(--calH);}
  #cardPerformance{height:var(--calH);}
  #cardEventDetails{height:var(--contribH);}
}

/* span helpers */
.col-span-2{ grid-column: span 2; }
@media (max-width:1200px){ .col-span-2{ grid-column: span 1; } }

/* -------- Cards -------- */
.card{background:var(--surf)!important;border:1px solid var(--border)!important;border-radius:16px!important;box-shadow:var(--shadow)!important;overflow:hidden}
.card-header{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;border-bottom:1px solid var(--border);background:none!important}
.card-header h3{margin:0!important;font-size:16px!important;font-weight:600!important;color:var(--ink)!important;display:flex;align-items:center;gap:8px}

/* -------- Lists -------- */
.list{padding:14px 18px; max-height: calc(var(--calH) - 70px); overflow-y: auto}
.empty{padding:32px 0;text-align:center;color:var(--muted);font-size:15px}
.list-item{display:flex;gap:14px;align-items:center;padding:14px;border-radius:10px;border:1px solid var(--border);background:#fff;margin-bottom:10px}
.bullet{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#eef2ff;color:#4f46e5}
.bullet.returned{background:#f3e8ff;color:#7c3aed}
.bullet.under_review{background:#e0f2fe;color:#0369a1}
.list-body{flex:1}
.list-body h4{margin:0 0 3px 0;font-size:15px;font-weight:600}
.list-body p{margin:0;color:var(--muted);font-size:13px}
.chip-btn{padding:6px 12px;border:1px solid var(--border);border-radius:6px;background:#fff;font-size:12px;color:var(--ink);text-decoration:none;transition:all .2s}
.chip-btn:hover{background:var(--subtle);border-color:var(--primary);color:var(--primary)}
.chip-btn:focus-visible{outline:3px solid rgba(38,68,135,.3);outline-offset:2px}

/* -------- Chart -------- */
.chart-wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;gap:16px}
.chart-wrap.donut canvas{width:180px!important;height:180px!important}
.chart-legend{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;width:100%;max-width:300px}
.legend-row{display:flex;gap:8px;align-items:center;font-size:13px}
.legend-dot{width:10px;height:10px;border-radius:50%}

/* -------- Segmented Control -------- */
.header-actions{display:flex;gap:10px;align-items:center}
.seg{display:flex;border:1px solid var(--border);border-radius:6px;overflow:hidden}
.seg-btn{padding:6px 12px;font-size:12px;color:var(--muted);background:#fff;border:none;cursor:pointer;transition:all .2s}
.seg-btn:hover{background:var(--subtle);color:var(--ink)}
.seg-btn.active{background:var(--primary);color:#fff}

/* -------- Calendar -------- */
.mini-cal{padding:16px}
.cal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
#calTitle{font-weight:600;font-size:15px}
.cal-nav{width:28px;height:28px;border:1px solid var(--border);border-radius:6px;background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .2s,border-color .2s}
.cal-nav:hover{background:var(--subtle);border-color:var(--primary)}
.cal-weekdays{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;font-size:11px;color:var(--muted);text-align:center;margin-bottom:6px}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px}
.day{padding:6px 2px;text-align:center;border-radius:6px;font-size:13px;cursor:pointer;transition:all .2s;position:relative}
.day.has-event::after{content:"";position:absolute;bottom:4px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:#e74c3c}
.day.has-meeting::after{content:"";position:absolute;bottom:4px;left:50%;transform:translateX(-50%);width:6px;height:6px;border-radius:50%;background:#0ea5e9}
.day:hover{background:var(--subtle)}
.day.today{background:var(--primary);color:#fff;font-weight:600}
.day.muted{opacity:.4}

/* -------- Upcoming -------- */
.upcoming{padding:14px 16px;border-top:1px solid var(--border);max-height:320px;overflow:auto}
.u-item{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border:1px solid var(--border);border-radius:6px;background:#fff;margin-bottom:6px;font-size:13px}

/* -------- To-do (kept for parity) -------- */
.todo{list-style:none;margin:0;padding:14px 16px}
.todo li{display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--border);border-radius:6px;background:#fff;margin-bottom:6px}
.todo input[type="checkbox"]{width:14px;height:14px}
.todo .rm{margin-left:auto;border:none;background:transparent;color:#ef4444;cursor:pointer;padding:2px}

/* -------- Heatmap -------- */
#cardContribution { display: flex; flex-direction: column; }
#cardContribution .heatmap { flex: 1; padding: 20px; }

.hm-grid { display: grid; grid-auto-flow: column; grid-auto-columns: min-content; gap: var(--hm-gap, 3px); }
.hm-col { display: grid; grid-template-rows: repeat(7, var(--hm-size, 10px)); gap: var(--hm-gap, 3px); }
.hm-cell { width: var(--hm-size, 10px); height: var(--hm-size, 10px); border-radius: 2px; background: #e5e7eb; }
/* Blue theme levels */
.hm-cell.l1{ background:#bfdbfe; }
.hm-cell.l2{ background:#93c5fd; }
.hm-cell.l3{ background:#60a5fa; }
.hm-cell.l4{ background:#3b82f6; }

/* -------- Links & selects -------- */
.link-muted{color:var(--muted);text-decoration:none}
.link-muted:hover{color:var(--primary)}
.select{border:1px solid var(--border);background:#fff;border-radius:6px;padding:6px 10px;font-size:12px}

/* -------- Modals -------- */
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
.modal-content { background: white; border-radius: 12px; padding: 24px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); }
.modal-large { max-width: 600px; }
.modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.modal-header h3 { margin: 0; font-size: 18px; font-weight: 600; color: var(--ink); }
.modal-close { background: none; border: none; font-size: 24px; color: var(--muted); cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 6px; }
.modal-close:hover { background: var(--subtle); color: var(--ink); }

.form-group { margin-bottom: 16px; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--ink); font-size: 14px; }
.form-group input, .form-group select, .form-group textarea { width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; background: white; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(38, 68, 135, 0.1); }
.form-group select[multiple] { min-height: 80px; }
.form-group small { display: block; margin-top: 4px; font-size: 12px; color: var(--muted); }

.modal-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border); }

/* -------- Buttons (scoped; keeps Bootstrap from bleeding) -------- */
.ems-dashboard .btn,
.ems-dashboard .btn-primary,
.ems-dashboard .btn-secondary{all:unset;}

/* re-apply our button design */
.btn-primary,
.btn-secondary{
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 1px solid;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  line-height:1.2;
}
.btn-primary{background: var(--primary); color: #fff; border-color: var(--primary);}
.btn-primary:hover{background:#1e3a73; border-color:#1e3a73;}
.btn-primary:disabled{opacity:.6; cursor:not-allowed;}

.btn-secondary{background:#fff; color: var(--ink); border-color: var(--border);}
.btn-secondary:hover{background: var(--subtle); border-color: var(--muted);}
.btn-secondary:disabled{opacity:.6; cursor:not-allowed;}

/* -------- Event Details -------- */
.event-details-content { padding: 14px 16px; min-height: 120px; max-height: calc(var(--contribH) - 70px); overflow-y: auto }
.event-detail-item { padding: 12px; margin-bottom: 8px; border: 1px solid var(--border); border-radius: 8px; background: white; }
.event-detail-title { font-size: 16px; font-weight: 600; color: var(--ink); margin-bottom: 4px; }
.event-detail-meta { font-size: 13px; color: var(--muted); margin-bottom: 8px; }
.event-detail-actions { display: flex; gap: 8px; }

/* -------- Proposal Tracker -------- */
.proposal-tracker-section { margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border); max-height: calc(var(--calH) - 140px); overflow-y: auto; }
.proposal-tracker-section h4 { margin: 0 0 12px 0; font-size: 14px; font-weight: 600; color: var(--ink); }
.proposal-item { display: flex; align-items: center; gap: 10px; padding: 8px; margin-bottom: 6px; border: 1px solid var(--border); border-radius: 6px; background: white; font-size: 13px; }
.proposal-status-badge { padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
.status-submitted { background: #dbeafe; color: #1e40af; }
.status-under_review { background: #fef3c7; color: #d97706; }
.status-approved { background: #d1fae5; color: #059669; }
.status-rejected { background: #fee2e2; color: #dc2626; }
.status-returned { background: #ede9fe; color: #7c3aed; }
